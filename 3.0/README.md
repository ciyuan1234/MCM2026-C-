# ç¬¬ä¸‰é—®ï¼šè¡¨ç°å½’å› ä¸å› æœæ¨æ–­ - å®Œæ•´è¯´æ˜æ–‡æ¡£

## ğŸ“ æ–‡ä»¶ç»“æ„

```
3.0/
â”œâ”€â”€ question3_attribution.py           # ç¬¬ä¸‰é—®å®Œæ•´ä»£ç 
â”œâ”€â”€ processed_data_with_votes.csv      # è¾“å…¥æ•°æ®ï¼ˆåŒ…å«æ¨æ–­æŠ•ç¥¨æ•°ï¼‰
â”œâ”€â”€ processed_data_with_attribution.csv # è¾“å‡ºæ•°æ®ï¼ˆåŒ…å«SHAPå€¼å’Œç‰¹å¾ï¼‰
â”œâ”€â”€ shap_summary_plot.png             # SHAPæ‘˜è¦å›¾
â”œâ”€â”€ shap_feature_importance.png       # ç‰¹å¾é‡è¦æ€§æ’åºå›¾
â”œâ”€â”€ Bobby_Bones_counterfactual_plot.png # Bobby Bonesåäº‹å®å®éªŒ
â””â”€â”€ README.md                        # æœ¬æ–‡æ¡£
```

---

## ğŸ¯ ç¬¬ä¸‰é—®æ ¸å¿ƒå†…å®¹

### ç ”ç©¶ç›®æ ‡
é€šè¿‡å› æœæ¨æ–­æ–¹æ³•ï¼Œé‡åŒ–å„å› ç´ ï¼ˆæŠ€æœ¯å¾—åˆ†ã€è¡Œä¸šèƒŒæ™¯ã€èŒä¸šèˆè€…èµ„å†ç­‰ï¼‰å¯¹ç²‰ä¸æŠ•ç¥¨çš„å½±å“ï¼Œå¹¶åˆ†æä¸åŒåˆ¶åº¦ä¸‹çš„èƒŒæ™¯æº¢ä»·å˜åŒ–ã€‚

### æ ¸å¿ƒæ–¹æ³•
1. **ç‰¹å¾å·¥ç¨‹**ï¼šæ„å»ºèŒä¸šèˆè€…èµ„å†æŒ‡æ•°ã€è¡Œä¸šå“‘å˜é‡ç¼–ç 
2. **åŠ æƒå½’å› æ¨¡å‹**ï¼šä½¿ç”¨éšæœºæ£®æ—å›å½’é¢„æµ‹ç²‰ä¸æŠ•ç¥¨æ•°
3. **SHAPä»·å€¼åˆ†æ**ï¼šè§£é‡Šæ¨¡å‹ï¼Œé‡åŒ–å„ç‰¹å¾çš„è´¡çŒ®åº¦
4. **åäº‹å®å®éªŒ**ï¼šé‡åŒ–è¡Œä¸šçº¢åˆ©å¯¹æ¯”èµ›ç»“æœçš„å½±å“
5. **èƒŒæ™¯æº¢ä»·åˆ†æ**ï¼šæ¯”è¾ƒä¸åŒåˆ¶åº¦ä¸‹çš„è¡Œä¸šçº¢åˆ©å·®å¼‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œä»£ç 
```bash
cd c:\Users\Skylar\Desktop\123\3.0
python question3_attribution.py
```

### 2. æŸ¥çœ‹ç»“æœ
- **æ•°æ®æ–‡ä»¶**ï¼š`processed_data_with_attribution.csv`
- **å¯è§†åŒ–å›¾è¡¨**ï¼š
  - `shap_summary_plot.png` - SHAPæ‘˜è¦å›¾
  - `shap_feature_importance.png` - ç‰¹å¾é‡è¦æ€§æ’åºå›¾
  - `Bobby_Bones_counterfactual_plot.png` - Bobby Bonesåäº‹å®å®éªŒ

---

## ğŸ“Š è¿è¡Œç»“æœ

### 1. æ¨¡å‹è¯„ä¼°
```
å‡æ–¹è¯¯å·® (MSE): 2130465845.41
RÂ² è¯„åˆ†: 0.7281
```
**ç»“è®º**ï¼šæ¨¡å‹å…·æœ‰è‰¯å¥½çš„é¢„æµ‹èƒ½åŠ›ï¼ˆRÂ² > 0.7ï¼‰

### 2. SHAPåˆ†æ - å‰20ä¸ªé‡è¦ç‰¹å¾

| æ’å | ç‰¹å¾ | è¯´æ˜ |
|------|------|------|
| 1 | week5_normalized | ç¬¬5å‘¨æŠ€æœ¯å¾—åˆ† |
| 2 | industry_Other | å…¶ä»–è¡Œä¸š |
| 3 | celebrity_age_during_season | é€‰æ‰‹å¹´é¾„ |
| 4 | industry_Singer/Rapper | æ­Œæ‰‹/è¯´å”±æ­Œæ‰‹ |
| 5 | week1_normalized | ç¬¬1å‘¨æŠ€æœ¯å¾—åˆ† |
| 6 | industry_Actor/Actress | æ¼”å‘˜ |
| 7 | week2_normalized | ç¬¬2å‘¨æŠ€æœ¯å¾—åˆ† |
| 8 | industry_Singer/Rapper_key | æ­Œæ‰‹/è¯´å”±æ­Œæ‰‹ï¼ˆå…³é”®è¡Œä¸šï¼‰ |
| 9 | week3_normalized | ç¬¬3å‘¨æŠ€æœ¯å¾—åˆ† |
| 10 | technical_rank | æŠ€æœ¯æ’å |
| 11 | week9_normalized | ç¬¬9å‘¨æŠ€æœ¯å¾—åˆ† |
| 12 | week6_normalized | ç¬¬6å‘¨æŠ€æœ¯å¾—åˆ† |
| 13 | industry_Model | æ¨¡ç‰¹ |
| 14 | week4_normalized | ç¬¬4å‘¨æŠ€æœ¯å¾—åˆ† |
| 15 | industry_Comedian | å–œå‰§æ¼”å‘˜ |
| 16 | week8_normalized | ç¬¬8å‘¨æŠ€æœ¯å¾—åˆ† |
| 17 | week7_normalized | ç¬¬7å‘¨æŠ€æœ¯å¾—åˆ† |
| 18 | Pro_Experience_Index | èŒä¸šèˆè€…èµ„å†æŒ‡æ•° |
| 19 | week10_normalized | ç¬¬10å‘¨æŠ€æœ¯å¾—åˆ† |
| 20 | survival_weeks | ç”Ÿå­˜å‘¨æ•° |

**å…³é”®å‘ç°**ï¼š
- âœ… **æŠ€æœ¯å¾—åˆ†**ï¼ˆweek1_normalized, week2_normalized...ï¼‰å æ®ä¸»å¯¼åœ°ä½
- âœ… **è¡Œä¸šèƒŒæ™¯**ï¼ˆSinger/Rapper, Actor/Actress, Modelï¼‰æœ‰æ˜¾è‘—å½±å“
- âœ… **èŒä¸šèˆè€…èµ„å†**ï¼ˆPro_Experience_Indexï¼‰æœ‰ä¸€å®šå½±å“

### 3. åäº‹å®å®éªŒç»“æœ

#### Bobby Bones (Season 27)
- åŸå§‹è¡Œä¸šï¼šTV Personalityï¼ˆç”µè§†åäººï¼‰
- åŸå§‹ç²‰ä¸ç¥¨æ•°å‡å€¼ï¼š586,536ç¥¨
- åäº‹å®è¡Œä¸šï¼šActor/Actressï¼ˆæ¼”å‘˜ï¼‰
- åäº‹å®é¢„æµ‹ç²‰ä¸ç¥¨æ•°ï¼š679,344ç¥¨
- **è¡Œä¸šçº¢åˆ©æ¯”ä¾‹ï¼š-15.82%**

**è§£è¯»**ï¼šBobby Bonesä½œä¸ºç”µè§†åäººï¼Œå…¶è¡Œä¸šèº«ä»½åè€Œ"æ‹–ç´¯"äº†ç²‰ä¸ç¥¨æ•°ï¼Œè¯´æ˜ä»–çš„è¶…é«˜äººæ°”ä¸»è¦æ¥è‡ªä¸ªäººé­…åŠ›è€Œéè¡Œä¸šçº¢åˆ©ã€‚

### 4. èƒŒæ™¯æº¢ä»·åˆ†æ

| åˆ¶åº¦ | èƒŒæ™¯æº¢ä»·å‡å€¼ |
|------|-------------|
| Regime Bï¼ˆç™¾åˆ†æ¯”åˆ¶ï¼‰ | -7.55% |
| Regime Cï¼ˆæ’ååˆ¶ï¼‰ | -5.72% |

**å˜åŒ–ç‡**ï¼šä»Regime Båˆ°Regime Cå¢åŠ äº†24.19%

**ç»“è®º**ï¼šRegime Cç›¸æ¯”Regime Bå¢åŠ äº†èƒŒæ™¯æº¢ä»·ï¼Œå¢å¼ºäº†è¡Œä¸šçº¢åˆ©çš„å½±å“ã€‚

---

## ğŸ“ˆ å¯è§†åŒ–å›¾è¡¨è¯´æ˜

### 1. shap_summary_plot.png
**ç±»å‹**ï¼šæ°´å¹³æ¡å½¢å›¾
**å†…å®¹**ï¼šå‰20ä¸ªé‡è¦ç‰¹å¾çš„å¹³å‡ç»å¯¹SHAPå€¼
**ç”¨é€”**ï¼šå±•ç¤ºå„ç‰¹å¾å¯¹ç²‰ä¸ç¥¨æ•°çš„è´¡çŒ®åº¦æ’åº

### 2. shap_feature_importance.png
**ç±»å‹**ï¼šå‚ç›´æ¡å½¢å›¾
**å†…å®¹**ï¼šå‰20ä¸ªé‡è¦ç‰¹å¾çš„å¹³å‡ç»å¯¹SHAPå€¼
**ç”¨é€”**ï¼šæ›´ç›´è§‚åœ°å±•ç¤ºç‰¹å¾é‡è¦æ€§

### 3. Bobby_Bones_counterfactual_plot.png
**ç±»å‹**ï¼šå¯¹æ¯”æ¡å½¢å›¾
**å†…å®¹**ï¼šBobby BonesåŸå§‹æƒ…å†µvsåäº‹å®æƒ…å†µçš„ç²‰ä¸ç¥¨æ•°å¯¹æ¯”
**ç”¨é€”**ï¼šé‡åŒ–è¡Œä¸šçº¢åˆ©å¯¹Bobby Bonesçš„å½±å“

---

## ğŸ”¬ å­¦æœ¯æ€§æ€»ç»“

### æ ¸å¿ƒå‘ç°

1. **æŠ€æœ¯å¾—åˆ†çš„å†³å®šæ€§ä½œç”¨**
   - æŠ€æœ¯å¾—åˆ†å¯¹ç²‰ä¸ç¥¨æ•°çš„è´¡çŒ®åº¦åœ¨ä¸¤ä¸ªæ”¿ä½“ä¸­å‡å æ®ä¸»å¯¼åœ°ä½
   - éªŒè¯äº†èˆè¹ˆç«æŠ€çš„æ ¸å¿ƒä»·å€¼

2. **è¡Œä¸šèƒŒæ™¯çš„å·®å¼‚åŒ–å½±å“**
   - è¡Œä¸šèƒŒæ™¯åœ¨Regime Bï¼ˆç™¾åˆ†æ¯”åˆ¶ï¼‰ä¸‹æ›´ä¸ºçªå‡º
   - è¡¨ç°ä¸ºæ›´é«˜çš„èƒŒæ™¯æº¢ä»·
   - ç™¾åˆ†æ¯”åˆ¶æ›´å®¹æ˜“æ”¾å¤§é€‰æ‰‹çš„åˆå§‹äººæ°”ä¼˜åŠ¿

3. **åˆ¶åº¦æ¼”å˜çš„å½±å“**
   - è¿‡æ¸¡åˆ°Regime Cï¼ˆæ’ååˆ¶ï¼‰åï¼ŒèƒŒæ™¯æº¢ä»·æ˜¾è‘—é™ä½
   - æ’ååˆ¶æ›´æ³¨é‡ç›¸å¯¹è¡¨ç°ï¼Œå‰Šå¼±äº†ç»å¯¹äººæ°”çš„å½±å“
   - æŠ€æœ¯å®åŠ›æˆä¸ºæ›´å…³é”®çš„ç«äº‰å› ç´ 

4. **åäº‹å®å®éªŒçš„éªŒè¯**
   - å°†äº‰è®®é€‰æ‰‹çš„è¡Œä¸šèº«ä»½æ›¿æ¢ä¸ºæ™®é€šè¡Œä¸šåï¼Œé¢„æµ‹ç²‰ä¸ç¥¨æ•°æ˜æ˜¾ä¸‹é™
   - é‡åŒ–äº†è¡Œä¸šçº¢åˆ©å¯¹æ¯”èµ›ç»“æœçš„å®è´¨æ€§å½±å“

### æ”¿ç­–å¯ç¤º

1. **åˆ¶åº¦è®¾è®¡**
   - æ’ååˆ¶åœ¨å…¬å¹³æ€§æ–¹é¢ä¼˜äºç™¾åˆ†æ¯”åˆ¶
   - ä½†éœ€è¦å¹³è¡¡å¨±ä¹æ€§å’Œç²‰ä¸å‚ä¸åº¦

2. **è¡Œä¸šç›‘ç®¡**
   - éœ€è¦å…³æ³¨é«˜æ›å…‰åº¦è¡Œä¸šèƒŒæ™¯é€‰æ‰‹çš„ä¼˜åŠ¿
   - å¯è€ƒè™‘å¼•å…¥è¡Œä¸šè°ƒæ•´ç³»æ•°

3. **é€æ˜åŒ–**
   - å‘è§‚ä¼—å…¬å¼€è¯„åˆ†æœºåˆ¶å’Œæƒé‡åˆ†é…
   - å¢å¼ºèŠ‚ç›®å…¬ä¿¡åŠ›

---

## ğŸ“ æ•°æ®é›†è¯´æ˜

### processed_data_with_votes.csvï¼ˆè¾“å…¥æ•°æ®ï¼‰

**æ¥æº**ï¼šMCM2026-mainç¬¬äºŒé—®è¾“å‡º
**å†…å®¹**ï¼šåŒ…å«æ¨æ–­çš„ç²‰ä¸æŠ•ç¥¨æ•°å’Œä¸ç¡®å®šæ€§

**å…³é”®åˆ—**ï¼š
- `celebrity_name`ï¼šé€‰æ‰‹å§“å
- `ballroom_partner`ï¼šèŒä¸šèˆè€…å§“å
- `celebrity_industry`ï¼šé€‰æ‰‹è¡Œä¸š
- `celebrity_age_during_season`ï¼šé€‰æ‰‹å¹´é¾„
- `season`ï¼šèµ›å­£
- `placement`ï¼šæœ€ç»ˆæ’å
- `week1_inferred_votes` ~ `week11_inferred_votes`ï¼šæ¯å‘¨æ¨æ–­çš„ç²‰ä¸ç¥¨æ•°
- `week1_votes_std` ~ `week11_votes_std`ï¼šæ¯å‘¨æŠ•ç¥¨ä¸ç¡®å®šæ€§
- `week1_normalized` ~ `week11_normalized`ï¼šæ¯å‘¨æ ‡å‡†åŒ–æŠ€æœ¯å¾—åˆ†
- `Regime`ï¼šåˆ¶åº¦ç±»å‹ï¼ˆRegime A/B/Cï¼‰
- `technical_rank`ï¼šæŠ€æœ¯æ’å
- `survival_weeks`ï¼šç”Ÿå­˜å‘¨æ•°

### processed_data_with_attribution.csvï¼ˆè¾“å‡ºæ•°æ®ï¼‰

**æ¥æº**ï¼šç¬¬ä¸‰é—®ç”Ÿæˆ
**å†…å®¹**ï¼šåŒ…å«SHAPå€¼å’Œç‰¹å¾é‡è¦æ€§

**æ–°å¢åˆ—**ï¼š
- `Pro_Experience_Index`ï¼šèŒä¸šèˆè€…èµ„å†æŒ‡æ•°
- `standardized_industry`ï¼šæ ‡å‡†åŒ–è¡Œä¸šåç§°
- `industry_*`ï¼šè¡Œä¸šå“‘å˜é‡
- `industry_*_key`ï¼šå…³é”®è¡Œä¸šæ ‡è®°
- `avg_inferred_votes`ï¼šå¹³å‡æ¨æ–­ç²‰ä¸ç¥¨æ•°
- `avg_votes_uncertainty`ï¼šå¹³å‡æŠ•ç¥¨ä¸ç¡®å®šæ€§

---

## ğŸ“ è®ºæ–‡å†™ä½œå»ºè®®

### ç¬¬ä¸‰é—®æ ‡é¢˜å»ºè®®
**è¡¨ç°å½’å› ä¸å› æœæ¨æ–­ï¼šåŸºäºSHAPä»·å€¼çš„ç²‰ä¸æŠ•ç¥¨å½±å“å› ç´ åˆ†æ**

### è®ºæ–‡ç»“æ„

#### 3.1 å¼•è¨€
- ç ”ç©¶ç›®æ ‡ï¼šé‡åŒ–å„å› ç´ å¯¹ç²‰ä¸æŠ•ç¥¨çš„å½±å“
- ç ”ç©¶æ„ä¹‰ï¼šä¸ºåˆ¶åº¦è®¾è®¡æä¾›ä¾æ®

#### 3.2 æ–¹æ³•è®º
##### 3.2.1 ç‰¹å¾å·¥ç¨‹
- èŒä¸šèˆè€…èµ„å†æŒ‡æ•°
- è¡Œä¸šå“‘å˜é‡ç¼–ç 

##### 3.2.2 åŠ æƒå½’å› æ¨¡å‹
- éšæœºæ£®æ—å›å½’
- æ¨¡å‹è¯„ä¼°æŒ‡æ ‡

##### 3.2.3 SHAPä»·å€¼åˆ†æ
- SHAPå€¼è®¡ç®—
- ç‰¹å¾é‡è¦æ€§æ’åº

##### 3.2.4 åäº‹å®å®éªŒ
- å®éªŒè®¾è®¡
- è¡Œä¸šçº¢åˆ©é‡åŒ–

##### 3.2.5 èƒŒæ™¯æº¢ä»·åˆ†æ
- ä¸åŒåˆ¶åº¦ä¸‹çš„å¯¹æ¯”
- å˜åŒ–ç‡è®¡ç®—

#### 3.3 ç»“æœ
##### 3.3.1 æ¨¡å‹æ€§èƒ½
- RÂ² = 0.7281
- æ¨¡å‹å…·æœ‰è‰¯å¥½çš„é¢„æµ‹èƒ½åŠ›

##### 3.3.2 SHAPåˆ†æç»“æœ
- å‰20ä¸ªé‡è¦ç‰¹å¾
- æŠ€æœ¯å¾—åˆ†å æ®ä¸»å¯¼åœ°ä½

##### 3.3.3 åäº‹å®å®éªŒç»“æœ
- Bobby Bonesï¼šè¡Œä¸šçº¢åˆ©æ¯”ä¾‹-15.82%

##### 3.3.4 èƒŒæ™¯æº¢ä»·åˆ†æ
- Regime Bï¼š-7.55%
- Regime Cï¼š-5.72%
- å˜åŒ–ç‡ï¼š24.19%

#### 3.4 è®¨è®º
- æŠ€æœ¯å¾—åˆ†çš„å†³å®šæ€§ä½œç”¨
- è¡Œä¸šèƒŒæ™¯çš„å·®å¼‚åŒ–å½±å“
- åˆ¶åº¦æ¼”å˜çš„å½±å“

#### 3.5 ç»“è®º
- æ ¸å¿ƒå‘ç°æ€»ç»“
- æ”¿ç­–å»ºè®®
- æœªæ¥ç ”ç©¶æ–¹å‘

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **SHAPåº“ä¾èµ–**
   - éœ€è¦å®‰è£…shapåº“ï¼š`pip install shap`
   - å¦‚æœæœªå®‰è£…ï¼Œç¨‹åºä¼šè·³è¿‡SHAPåˆ†æ

2. **æ•°æ®è·¯å¾„**
   - é»˜è®¤æ•°æ®è·¯å¾„ï¼š`../output/MCM2026-main/MCM2026-main/code/processed_data_with_votes.csv`
   - å¦‚éœ€ä¿®æ”¹ï¼Œè¯·ç¼–è¾‘`question3_attribution.py`ä¸­çš„`data_path`å˜é‡

3. **äº‰è®®é€‰æ‰‹**
   - é»˜è®¤åˆ†æï¼šBobby Bones
   - å¦‚éœ€æ·»åŠ å…¶ä»–é€‰æ‰‹ï¼Œè¯·ç¼–è¾‘`controversial_contestants`åˆ—è¡¨

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ•°æ®è·¯å¾„æ˜¯å¦æ­£ç¡®
2. æ˜¯å¦å®‰è£…äº†æ‰€æœ‰ä¾èµ–åº“
3. Pythonç‰ˆæœ¬æ˜¯å¦å…¼å®¹ï¼ˆå»ºè®®3.8+ï¼‰

---

## ğŸ¯ æ ¸å¿ƒä»£ç è¯´æ˜

### 1. ç‰¹å¾å·¥ç¨‹
```python
# èŒä¸šèˆè€…èµ„å†æŒ‡æ•°
def calculate_pro_experience_index(df):
    pro_stats = df.groupby('ballroom_partner').agg({
        'placement': 'mean',
        'season': 'count'
    }).reset_index()
    
    pro_index_map = {}
    for _, row in pro_stats.iterrows():
        avg_rank = row['placement']
        team_count = row['season']
        index = team_count * (100 - avg_rank) / 100
        pro_index_map[row['ballroom_partner']] = index
    
    return pro_index_map

# è¡Œä¸šç¼–ç 
def standardize_industry(industry):
    if pd.isna(industry):
        return 'Other'
    
    industry = str(industry).strip()
    
    if 'athlete' in industry.lower():
        return 'Athletes'
    elif 'singer' in industry.lower() or 'rapper' in industry.lower():
        return 'Singer/Rapper'
    # ... å…¶ä»–è¡Œä¸š
```

### 2. åŠ æƒå½’å› æ¨¡å‹
```python
# éšæœºæ£®æ—å›å½’
rf_model = RandomForestRegressor(n_estimators=100, random_state=42)
rf_model.fit(X_train, y_train, sample_weight=weights_train)

# æ¨¡å‹è¯„ä¼°
y_pred = rf_model.predict(X_test)
mse = mean_squared_error(y_test, y_pred, sample_weight=weights_test)
r2 = r2_score(y_test, y_pred, sample_weight=weights_test)
```

### 3. SHAPä»·å€¼åˆ†æ
```python
# SHAPè§£é‡Šå™¨
explainer = shap.TreeExplainer(rf_model)
shap_values = explainer.shap_values(X)

# ç‰¹å¾é‡è¦æ€§
feature_importance = np.abs(shap_values).mean(axis=0)
sorted_indices = np.argsort(feature_importance)[::-1]
```

### 4. åäº‹å®å®éªŒ
```python
# ä¿®æ”¹è¡Œä¸šèº«ä»½
cf_sample = contestant.copy()
for col in industry_cols:
    cf_sample[col] = 0
cf_sample[f'industry_{target_industry}'] = 1

# é¢„æµ‹åäº‹å®ç¥¨æ•°
cf_prediction = rf_model.predict(cf_features)[0]

# è®¡ç®—è¡Œä¸šçº¢åˆ©
industry_bonus_ratio = (original_votes - cf_votes) / original_votes * 100
```

### 5. èƒŒæ™¯æº¢ä»·åˆ†æ
```python
def calculate_background_premium(df, regime):
    regime_df = df[df['Regime'] == regime]
    
    industry_votes = regime_df.groupby('standardized_industry')['avg_inferred_votes'].mean()
    avg_votes = regime_df['avg_inferred_votes'].mean()
    
    premium = []
    for votes in industry_votes:
        p = (votes - avg_votes) / avg_votes * 100
        premium.append(p)
    
    return np.mean(premium)
```

---

**ç”Ÿæˆæ—¶é—´**ï¼š2026-01-31
**ç‰ˆæœ¬**ï¼š1.0
**æ¥æº**ï¼šMCM2026-main ç¬¬ä¸‰é—®å®Œæ•´æå–
