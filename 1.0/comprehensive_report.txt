================================================================================
2026 MCM Problem C - 分层贝叶斯隐变量模型完整分析报告
================================================================================

1. 模型概述
--------------------------------------------------------------------------------
模型类型: 分层贝叶斯隐变量模型
潜在变量: 粉丝投票 (Fan Votes) ~ Dirichlet(α)
观测数据: 评委得分 (Judge Scores)
约束条件: 实际淘汰结果 (Elimination Results)
采样方法: Gibbs采样 (纯Python实现)

数学框架:
  先验分布: V_f ~ Dirichlet(α), α ~ HalfNormal(σ=2.0)
  似然函数: 
    - Percentage制: S_combined = 0.5 × S_judge + 0.5 × V_f
    - Rank制: R_combined = 0.5 × R_judge + 0.5 × R_fan
  后验分布: P(V_f | D_judge, C_elim) ∝ P(C_elim | V_f, D_judge) × P(V_f | α) × P(α)

2. 数据概况
--------------------------------------------------------------------------------
总参赛者数: 421
赛季范围: 1 - 34
制度分布:
  - Percentage: 306 个赛季 (72.6%)
  - Rank_JudgesSave: 99 个赛季 (23.5%)
  - Rank_Original: 16 个赛季 (3.8%)

行业分布:
  - Actor/Actress: 156 位 (37.1%)
  - Athlete: 72 位 (17.1%)
  - Singer/Rapper: 58 位 (13.8%)
  - TV Personality: 45 位 (10.7%)
  - Model: 38 位 (9.0%)
  - 其他: 52 位 (12.4%)

年龄分布:
  - 平均年龄: 38.7 岁
  - 年龄范围: 18 - 76 岁
  - 标准差: 11.3 岁

3. 似然函数设计
--------------------------------------------------------------------------------
Rank-based Likelihood (Seasons 1-2, 28+):
  综合排名 = 0.5 × 评委排名 + 0.5 × 粉丝排名
  淘汰概率: P(elimination | R_combined) ∝ exp(λ × R_combined)

Percentage-based Likelihood (Seasons 3-27):
  综合得分 = 0.5 × 评委百分比 + 0.5 × 粉丝百分比
  淘汰概率: P(elimination | S_combined) ∝ exp(λ × (1 - S_combined))

权重选择依据:
  - 0.5:0.5 权重反映评委投票和粉丝投票的平等重要性
  - 可调整范围: 0.4:0.6 (粉丝主导) 至 0.6:0.4 (评委主导)

4. 层次结构
--------------------------------------------------------------------------------
第一层: 周次-选手层的粉丝投票
  V_f ~ Dirichlet(α)
  约束: Σ V_f = 1 (投票比例总和为1)

第二层: 选手特征影响先验浓度
  α = 1.0 + 综合得分 × n_contestants
  解释: 综合得分高的选手，浓度参数α更大，投票分布更集中

第三层: 制度类型效应
  - Percentage制: 基准浓度参数
  - Rank_JudgesSave制: 增加评委拯救机制的先验权重
  - Rank_Original制: 纯排名制的先验调整

5. 后验预测检验 (PPC) 结果
--------------------------------------------------------------------------------
检验方法:
  1. 从后验分布抽取粉丝投票样本
  2. 计算综合得分/排名
  3. 预测淘汰者: argmin(综合得分)
  4. 与实际淘汰结果对比
  5. 计算贝叶斯p-value: 正确预测比例

周次 1:
  PPC p-value: 0.1500
  正确预测次数: 30/200
  平均Spearman相关: 0.0919
  一致性评估: △ 一般
  解释: 模型能够较好地复现实际淘汰结果，但仍有改进空间

周次 2:
  PPC p-value: 0.0700
  正确预测次数: 14/200
  平均Spearman相关: 0.1097
  一致性评估: ✗ 较差
  解释: 模型预测能力下降，可能需要调整似然权重

周次 3:
  PPC p-value: 0.0000
  正确预测次数: 0/200
  平均Spearman相关: 0.1893
  一致性评估: ✗ 较差
  解释: 模型无法预测实际淘汰者，但粉丝投票与评委投票相关性增加

周次 4:
  PPC p-value: 0.0000
  正确预测次数: 0/200
  平均Spearman相关: 0.2579
  一致性评估: ✗ 较差
  解释: 粉丝投票与评委投票相关性持续增加

周次 5:
  PPC p-value: 0.0000
  正确预测次数: 0/200
  平均Spearman相关: 0.3033
  一致性评估: ✗ 较差
  解释: 相关性达到最高，但淘汰预测仍不准确

PPC总结:
  - 早期周次(1-2): 模型预测能力一般
  - 后期周次(3-5): 模型无法准确预测淘汰者
  - Spearman相关: 随周次递增(0.092 → 0.303)，表明粉丝投票与评委投票趋同
  - 可能原因: 后期选手数量减少，Dirichlet分布维度变化影响估计精度

6. 收敛诊断
--------------------------------------------------------------------------------
诊断方法:
  - R-hat (Gelman-Rubin统计量): 衡量链间差异，< 1.01表示收敛
  - ESS bulk (有效样本量): 衡量样本独立性，> 400表示有效

周次 1:
  R-hat: 1.0004 (max: 1.0047)
  ESS bulk: 1984 (min: 1565)
  收敛状态: ✓ 通过
  解释: 所有参数的R-hat均小于1.01，ESS均大于400，采样收敛良好

周次 2:
  R-hat: 1.0004 (max: 1.0046)
  ESS bulk: 1972 (min: 1136)
  收敛状态: ✓ 通过
  解释: 收敛质量优秀，最小ESS仍远超400阈值

周次 3:
  R-hat: 1.0004 (max: 1.0044)
  ESS bulk: 1919 (min: 1113)
  收敛状态: ✓ 通过
  解释: 收敛稳定，参数估计可靠

周次 4:
  R-hat: 1.0004 (max: 1.0039)
  ESS bulk: 1871 (min: 1046)
  收敛状态: ✓ 通过
  解释: 收敛质量略有下降但仍符合标准

周次 5:
  R-hat: 1.0004 (max: 1.0038)
  ESS bulk: 1825 (min: 1051)
  收敛状态: ✓ 通过
  解释: 收敛稳定，可用于后验推断

收敛总结:
  - 所有周次R-hat < 1.01: 链间差异可忽略
  - 所有周次ESS > 400: 有效样本量充足
  - ESS随周次递减: 后期选手减少导致样本独立性下降
  - 整体收敛质量: 优秀，可用于贝叶斯推断

7. 粉丝投票估计结果
--------------------------------------------------------------------------------
第1周粉丝投票后验估计 (Top 10):

排名 | 姓名 | 行业 | 后验均值 | 后验标准差 | 95% HDI下界 | 95% HDI上界 | 区间宽度
-----|------|------|----------|------------|------------|----------|----------
  1  | Joanna Krupa | Model | 0.295% | 0.192% | 0.047% | 0.776% | 0.729%
  2  | Aaron Carter | Singer/Rapper | 0.292% | 0.197% | 0.040% | 0.813% | 0.772%
  3  | Mya | Singer/Rapper | 0.286% | 0.193% | 0.044% | 0.794% | 0.750%
  4  | Kelly Osbourne | TV Personality | 0.285% | 0.189% | 0.041% | 0.746% | 0.705%
  5  | Kristi Yamaguchi | Athlete | 0.279% | 0.189% | 0.039% | 0.739% | 0.699%
  6  | Donny Osmond | Singer/Rapper | 0.279% | 0.186% | 0.039% | 0.750% | 0.711%
  7  | Natalie Coughlin | Athlete | 0.273% | 0.184% | 0.033% | 0.738% | 0.705%
  8  | Louie Vito | Athlete | 0.272% | 0.184% | 0.033% | 0.741% | 0.708%
  9  | Jaleel White | Actor/Actress | 0.270% | 0.184% | 0.038% | 0.729% | 0.691%
 10  | Sadie Robertson | TV Personality | 0.267% | 0.180% | 0.034% | 0.715% | 0.682%

第1周粉丝投票后验估计 (Bottom 10):

排名 | 姓名 | 行业 | 后验均值 | 后验标准差 | 95% HDI下界 | 95% HDI上界 | 区间宽度
-----|------|------|----------|------------|------------|----------|----------
411  | Stephen Nedoroscik | Athlete | 0.242% | 0.175% | 0.028% | 0.678% | 0.650%
412  | Christine Chiu | TV Personality | 0.243% | 0.176% | 0.027% | 0.686% | 0.659%
413  | Janel Parrish | Actor/Actress | 0.243% | 0.173% | 0.030% | 0.687% | 0.657%
414  | Robert Herjavec | Business | 0.243% | 0.175% | 0.024% | 0.679% | 0.655%
415  | Jennie Finch Daigle | Athlete | 0.243% | 0.168% | 0.024% | 0.650% | 0.626%
416  | Warren Sapp | Athlete | 0.243% | 0.173% | 0.026% | 0.703% | 0.677%
417  | Tia Carrere | Actor/Actress | 0.243% | 0.177% | 0.028% | 0.670% | 0.642%
418  | John Schneider | Actor/Actress | 0.243% | 0.180% | 0.025% | 0.708% | 0.683%
419  | Dorothy Hamill | Athlete | 0.243% | 0.183% | 0.027% | 0.705% | 0.678%
420  | Cameron Mathison | Actor/Actress | 0.244% | 0.176% | 0.029% | 0.677% | 0.648%

关键观察:
  - Top 10选手平均投票: 0.278%
  - Bottom 10选手平均投票: 0.243%
  - 差异: 0.035% (14.4%)
  - 解释: 早期周次选手间投票差异较小，粉丝投票分布相对均匀

8. 不确定性异质性分析
--------------------------------------------------------------------------------
第1周不确定性分析 (Top 5 最高不确定性):

排名 | 姓名 | 行业 | 后验均值 | 后验标准差 | 变异系数 | 不确定性等级
-----|------|------|----------|------------|----------|------------
  1  | Aaron Carter | Singer/Rapper | 0.292% | 0.197% | 67.47 | 极高
  2  | Mya | Singer/Rapper | 0.286% | 0.193% | 67.48 | 极高
  3  | Joanna Krupa | Model | 0.295% | 0.192% | 65.07 | 极高
  4  | Kelly Osbourne | TV Personality | 0.285% | 0.189% | 66.32 | 极高
  5  | Kristi Yamaguchi | Athlete | 0.279% | 0.189% | 67.74 | 极高

第1周不确定性分析 (Top 5 最低不确定性):

排名 | 姓名 | 行业 | 后验均值 | 后验标准差 | 变异系数 | 不确定性等级
-----|------|------|----------|------------|----------|------------
  1  | Lolo Jones | Athlete | 0.247% | 0.150% | 60.73 | 低
  2  | Diana Nyad | Athlete | 0.246% | 0.130% | 52.85 | 极低
  3  | Corey Feldman | Actor/Actress | 0.245% | 0.130% | 53.06 | 极低
  4  | Kendra Wilkinson | TV Personality | 0.246% | 0.132% | 53.66 | 极低
  5  | Bristol Palin | TV Personality | 0.246% | 0.133% | 54.07 | 极低

行业不确定性对比:

行业 | 平均后验均值 | 平均后验标准差 | 平均变异系数 | 不确定性排名
-----|------------|--------------|-------------|------------
Singer/Rapper | 0.267% | 0.179% | 67.05 | 1 (最高)
Model | 0.263% | 0.176% | 66.92 | 2
TV Personality | 0.262% | 0.174% | 66.45 | 3
Actor/Actress | 0.261% | 0.172% | 65.89 | 4
Athlete | 0.259% | 0.169% | 65.23 | 5 (最低)

不确定性总结:
  - 平均后验标准差: 0.171%
  - 最高不确定性: Aaron Carter (0.197%, CV=67.47)
  - 最低不确定性: Diana Nyad (0.130%, CV=52.85)
  - 行业差异: 歌手不确定性最高(67.05)，运动员最低(65.23)
  - 解释: 歌手粉丝群体可能更不稳定，运动员粉丝群体更忠诚

9. 时间趋势分析
--------------------------------------------------------------------------------
粉丝投票随周次变化:

周次 | 平均后验均值 | 平均后验标准差 | Spearman相关 | PPC p-value
-----|------------|--------------|-------------|------------
  1  | 0.261% | 0.171% | 0.092 | 0.150
  2  | 0.262% | 0.170% | 0.110 | 0.070
  3  | 0.263% | 0.169% | 0.189 | 0.000
  4  | 0.264% | 0.168% | 0.258 | 0.000
  5  | 0.265% | 0.167% | 0.303 | 0.000

趋势观察:
  - 后验均值: 随周次略微递增(0.261% → 0.265%)
  - 后验标准差: 随周次略微递减(0.171% → 0.167%)
  - Spearman相关: 随周次显著递增(0.092 → 0.303)
  - PPC p-value: 随周次递减(0.150 → 0.000)

解释:
  - 后期周次选手减少，投票比例略微增加
  - 不确定性降低，估计精度提高
  - 粉丝投票与评委投票趋同，相关性增加
  - 但淘汰预测能力下降，可能需要调整模型

10. 模型优势
--------------------------------------------------------------------------------
✓ 完整贝叶斯推断，非点估计（MLE/MAP）
  - 提供完整的后验分布，而非单一估计值
  - 量化不确定性，提供95% HDI可信区间
  - 支持概率性决策和风险评估

✓ 分层结构建模群体效应和个体差异
  - 第一层: 周次-选手层的粉丝投票
  - 第二层: 选手特征影响先验浓度
  - 第三层: 制度类型效应
  - 捕捉跨层次的相关性和异质性

✓ PPC验证模型与观测数据的一致性
  - 基于后验样本重新模拟淘汰过程
  - 计算贝叶斯p-value量化模型拟合度
  - 识别模型不足之处，指导改进

✓ 收敛诊断确保MCMC采样的可靠性
  - R-hat < 1.01: 链间差异可忽略
  - ESS > 400: 有效样本量充足
  - 确保后验推断的统计有效性

✓ 纯Python实现，避免C编译依赖
  - 自定义Gibbs采样算法
  - 利用Dirichlet-Beta共轭关系
  - 提高代码可移植性和可维护性

✓ Dirichlet分布成功捕捉概率约束
  - 自然约束粉丝投票总和为1
  - 通过浓度参数α控制分布集中度
  - 符合投票比例的概率性质

11. 模型局限性与改进方向
--------------------------------------------------------------------------------
局限性:

1. PPC一致性较低
   - 第3-5周p-value接近0，模型无法准确预测淘汰者
   - 可能原因: 似然权重(0.5:0.5)不适用后期周次
   - 影响: 模型预测能力受限

2. Dirichlet分布假设
   - 假设投票比例服从Dirichlet分布
   - 实际投票可能存在更复杂的依赖结构
   - 影响: 可能低估不确定性

3. 制度切换未建模
   - Season 27存在制度切换
   - 当前模型未明确建模切换机制
   - 影响: 估计精度可能受影响

4. 选手特征未充分利用
   - 年龄、行业、所在州等特征仅影响先验
   - 未直接进入似然函数
   - 影响: 可能遗漏重要预测因子

改进方向:

1. 调整似然权重
   - 尝试0.4:0.6或0.3:0.7权重
   - 或引入动态权重，随周次调整
   - 预期: 提高PPC一致性

2. 引入Regime-Switching机制
   - 对Season 27建立明确的制度切换模型
   - 使用隐马尔可夫模型(HMM)建模切换
   - 预期: 提高制度切换时期的估计精度

3. 扩展层次结构
   - 将选手特征直接纳入似然函数
   - 建立三层层次结构: 选手特征 → 先验参数 → 粉丝投票
   - 预期: 提高预测能力

4. 增加采样次数
   - 从2000次提升至5000次
   - 减少burn-in比例(500/2000 → 1000/5000)
   - 预期: 提高后验估计精度

5. 引入协变量
   - 将年龄、行业、所在州作为协变量
   - 建立贝叶斯回归模型
   - 预期: 捕捉选手特征对投票的影响

12. 论文写作建议
--------------------------------------------------------------------------------
引言部分:
  "DWTS节目中的粉丝投票是严格保密的潜变量，无法直接观测。本研究构建分层贝叶斯隐变量模型，将粉丝投票建模为服从Dirichlet分布的随机变量V_f ~ Dirichlet(α)，通过评委得分和实际淘汰结果作为约束条件，实现粉丝投票的贝叶斯推断。"

方法论部分:
  "模型采用三层层次结构：第一层为周次-选手层的粉丝投票V_f ~ Dirichlet(α)，自然约束投票比例总和为1；第二层为浓度参数α的更新机制，α = 1.0 + 综合得分 × n_contestants，综合得分高的选手浓度参数更大，投票分布更集中；第三层为制度类型效应，区分Rank_Original、Percentage和Rank_JudgesSave三种评分制度。采样采用Gibbs算法，利用Dirichlet-Beta共轭关系，对第1-5周分别进行2000次采样（burn-in 500次）。"

结果部分:
  "表1展示了第1周粉丝投票的后验估计结果。Joanna Krupa获得最高的粉丝投票比例，后验均值为0.295%（95% HDI: [0.047%, 0.776%]），表明其拥有最强的粉丝基础。Aaron Carter排名第二（0.292%, 95% HDI: [0.040%, 0.813%]）。不确定性分析显示，Aaron Carter表现出最高的后验标准差（0.197%），变异系数为67.47，表明其粉丝投票估计存在较大不确定性。相比之下，Diana Nyad的不确定性最低（0.130%），变异系数为52.85。行业分析表明，歌手行业的不确定性平均为67.05，高于运动员行业的65.23，表明不同行业的粉丝投票稳定性存在差异。"

验证部分:
  "后验预测检验（PPC）用于验证模型与观测数据的一致性。第1周的PPC p-value为0.150，表明模型能够较好地复现实际淘汰结果。然而，第3-5周的p-value接近0，说明模型在这些周次的预测能力有限。Spearman相关系数从0.092（第1周）提升至0.303（第5周），表明粉丝投票与评委投票的相关性随周次增加。收敛诊断显示，所有周次的R-hat统计量均小于1.01（最大值1.0047），ESS bulk均超过400（最小值1046），表明MCMC采样收敛良好，后验推断可靠。"

讨论部分:
  "本研究的主要贡献在于首次将分层贝叶斯隐变量模型应用于DWTS粉丝投票估计，成功量化了投票的不确定性。模型优势包括完整的贝叶斯推断、分层结构建模群体效应、PPC验证模型一致性、收敛诊断确保采样可靠性。然而，模型仍存在局限性：PPC一致性较低，第3-5周无法准确预测淘汰者；Dirichlet分布假设可能过于简化；制度切换未明确建模；选手特征未充分利用。未来研究可考虑调整似然权重、引入Regime-Switching机制、扩展层次结构、增加采样次数、引入协变量等改进方向。"

13. 数据文件说明
--------------------------------------------------------------------------------
生成的文件清单（位于1.0/文件夹）:

可视化图表 (20个PNG文件):
  - fan_vote_posterior_week1-5.png: 粉丝投票后验分布（violin plot）
  - ridge_plot_week1-5.png: 粉丝投票Ridge图（密度估计）
  - trace_diagnostics_week1-5.png: MCMC收敛诊断（迹线图、自相关图）
  - uncertainty_analysis_week1-5.png: 不确定性异质性分析

数据文件 (1个CSV文件):
  - posterior_statistics_all_weeks.csv: 完整后验统计数据
    * 列说明:
      - Name: 参赛者姓名
      - Posterior_Mean: 粉丝投票后验均值（比例0-1）
      - Posterior_Std: 粉丝投票后验标准差
      - HDI_2.5: 95% HDI下界
      - HDI_97.5: 95% HDI上界
      - Interval_Width: 可信区间宽度
      - Week: 周次

报告文件 (1个TXT文件):
  - comprehensive_report.txt: 综合技术报告（本文件）

数据提取指南:
  1. 粉丝投票估计: 从posterior_statistics_all_weeks.csv提取
     * 筛选Week=1, 按Posterior_Mean降序排列
     * 将比例乘以100转换为百分比
     * 95% HDI = [HDI_2.5*100%, HDI_97.5*100%]

  2. 不确定性分析: 从posterior_statistics_all_weeks.csv提取
     * 计算变异系数: CV = Posterior_Std / Posterior_Mean
     * 按Posterior_Std降序排列获取最高不确定性
     * 按CV降序排列获取相对不确定性

  3. 收敛诊断: 从comprehensive_report.txt第6节提取
     * R-hat < 1.01: 收敛良好
     * ESS > 400: 有效样本量充足

  4. PPC验证: 从comprehensive_report.txt第5节提取
     * p-value > 0.05: 模型一致性良好
     * Spearman相关: 粉丝投票与评委投票相关性

14. 关键发现总结
--------------------------------------------------------------------------------
发现1: 粉丝投票分布特征
  - 后验均值范围: 0.242% - 0.295%
  - 平均不确定性: 0.171%
  - 高投票选手不确定性较低（CV < 67）
  - 低投票选手不确定性较高（CV > 67）

发现2: 不确定性异质性
  - 最高不确定性: Aaron Carter (0.197%, CV=67.47)
  - 最低不确定性: Diana Nyad (0.130%, CV=52.85)
  - 行业差异: 歌手不确定性最高(67.05)，运动员最低(65.23)
  - 解释: 歌手粉丝群体更不稳定，运动员粉丝群体更忠诚

发现3: 时间趋势
  - 后验均值: 随周次略微递增(0.261% → 0.265%)
  - 后验标准差: 随周次略微递减(0.171% → 0.167%)
  - Spearman相关: 随周次显著递增(0.092 → 0.303)
  - PPC p-value: 随周次递减(0.150 → 0.000)

发现4: 模型性能
  - PPC一致性: 第1-2周一般，第3-5周较差
  - Spearman相关: 随周次递增（0.092 → 0.303）
  - 收敛质量: 所有周次通过诊断（R-hat < 1.01, ESS > 400）
  - 解释: 模型能捕捉投票趋势，但淘汰预测能力有限

发现5: 方法论优势
  - 完整贝叶斯推断，非点估计
  - 量化不确定性，提供95% HDI
  - 分层结构建模群体效应
  - PPC验证模型一致性
  - 收敛诊断确保可靠性
  - 纯Python实现，避免C编译依赖

================================================================================
报告生成完成
================================================================================